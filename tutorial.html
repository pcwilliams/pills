<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building an iOS App with Claude Code - A Tutorial</title>
    <style>
        :root {
            --bg: #1a1a2e;
            --surface: #16213e;
            --surface-alt: #1c2a4a;
            --border: #0f3460;
            --text: #e0e0e0;
            --text-muted: #8899aa;
            --accent-cyan: #00d2d3;
            --accent-orange: #ff9f43;
            --accent-blue: #54a0ff;
            --accent-green: #00b894;
            --accent-purple: #a29bfe;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Helvetica Neue', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.8;
            padding: 40px 20px;
        }
        .container { max-width: 860px; margin: 0 auto; }
        h1 {
            font-size: 2.4rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
            margin-bottom: 16px;
        }
        .intro {
            color: var(--text);
            font-size: 1.05rem;
            margin-bottom: 48px;
            border-left: 3px solid var(--accent-cyan);
            padding-left: 20px;
        }
        h2 {
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--accent-cyan);
            margin: 56px 0 8px;
        }
        h2 .step-num {
            display: inline-block;
            background: var(--accent-cyan);
            color: var(--bg);
            width: 36px;
            height: 36px;
            line-height: 36px;
            text-align: center;
            border-radius: 50%;
            font-size: 1rem;
            margin-right: 10px;
            vertical-align: middle;
        }
        .step-subtitle {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-bottom: 20px;
        }
        h3 {
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--accent-orange);
            margin: 28px 0 12px;
        }
        p { margin-bottom: 14px; }

        .prompt {
            background: var(--surface-alt);
            border: 1px solid var(--accent-blue);
            border-left: 4px solid var(--accent-blue);
            border-radius: 0 12px 12px 0;
            padding: 20px 24px;
            margin: 20px 0;
            position: relative;
        }
        .prompt::before {
            content: 'YOUR PROMPT';
            position: absolute;
            top: -10px;
            left: 16px;
            background: var(--accent-blue);
            color: var(--bg);
            font-size: 0.7rem;
            font-weight: 700;
            padding: 2px 10px;
            border-radius: 4px;
            letter-spacing: 0.5px;
        }
        .prompt p { color: var(--text); margin-bottom: 0; }
        .prompt p + p { margin-top: 10px; }

        .response {
            background: var(--surface);
            border: 1px solid var(--border);
            border-left: 4px solid var(--accent-cyan);
            border-radius: 0 12px 12px 0;
            padding: 20px 24px;
            margin: 20px 0;
            position: relative;
        }
        .response::before {
            content: 'CLAUDE RESPONSE';
            position: absolute;
            top: -10px;
            left: 16px;
            background: var(--accent-cyan);
            color: var(--bg);
            font-size: 0.7rem;
            font-weight: 700;
            padding: 2px 10px;
            border-radius: 4px;
            letter-spacing: 0.5px;
        }

        .tip {
            background: rgba(0, 184, 148, 0.1);
            border: 1px solid rgba(0, 184, 148, 0.3);
            border-radius: 10px;
            padding: 16px 20px;
            margin: 20px 0;
        }
        .tip::before {
            content: 'TIP';
            display: inline-block;
            background: var(--accent-green);
            color: var(--bg);
            font-size: 0.7rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 4px;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .insight {
            background: rgba(162, 155, 254, 0.1);
            border: 1px solid rgba(162, 155, 254, 0.3);
            border-radius: 10px;
            padding: 16px 20px;
            margin: 20px 0;
        }
        .insight::before {
            content: 'KEY INSIGHT';
            display: inline-block;
            background: var(--accent-purple);
            color: var(--bg);
            font-size: 0.7rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 4px;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        code {
            font-family: 'SF Mono', 'Fira Code', monospace;
            background: rgba(0, 210, 211, 0.1);
            color: var(--accent-cyan);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        pre {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px 20px;
            overflow-x: auto;
            margin: 12px 0;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            color: var(--text);
        }
        ul, ol {
            margin: 12px 0 12px 24px;
            color: var(--text);
        }
        li { margin-bottom: 6px; }
        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .badge-cyan { background: rgba(0, 210, 211, 0.15); color: var(--accent-cyan); }
        .badge-orange { background: rgba(255, 159, 67, 0.15); color: var(--accent-orange); }
        .badge-blue { background: rgba(84, 160, 255, 0.15); color: var(--accent-blue); }

        .files-created {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 12px 0;
        }
        .file-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 12px;
            font-family: 'SF Mono', monospace;
            font-size: 0.8rem;
            color: var(--accent-orange);
        }
        .icon-preview {
            text-align: center;
            margin: 24px 0;
        }
        .icon-preview img {
            border-radius: 36px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }
        .toc {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px 32px;
            margin: 32px 0;
        }
        .toc h3 { margin-top: 0; }
        .toc ol { margin-bottom: 0; }
        .toc a {
            color: var(--accent-cyan);
            text-decoration: none;
        }
        .toc a:hover { text-decoration: underline; }
        hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 48px 0;
        }

        /* Bar colour classes (used by state-ref-card) */
        .bar.cyan         { background: #00d2d3; }
        .bar.orange       { background: #ff9f43; }
        .bar.cyan-dim     { background: rgba(0, 210, 211, 0.3); }
        .bar.orange-dim   { background: rgba(255, 159, 67, 0.3); }
        .bar.grey         { background: #888; }
        .bar.grey-dim     { background: rgba(136, 136, 136, 0.4); }

        /* State reference grid */
        .state-ref {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        .state-ref-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        .state-ref-card h4 {
            font-size: 0.75rem;
            color: var(--text);
            margin-bottom: 8px;
        }
        .state-ref-card .bar {
            height: 8px;
            border-radius: 3px;
            margin: 4px 12px;
        }
        .state-ref-card .note {
            font-size: 0.65rem;
            color: var(--text-muted);
            margin-top: 6px;
        }
    </style>
</head>
<body>
    <div class="container">

        <h1>Building an iOS App with Claude Code</h1>
        <p class="subtitle">A step-by-step tutorial: from idea to running app in one conversation</p>

        <!-- Hero screenshot -->
        <div style="text-align: center; margin: 32px 0 40px;">
            <div style="display: inline-block; background: #000; border-radius: 40px; padding: 14px; box-shadow: 0 16px 64px rgba(0,0,0,0.6);">
                <img src="pillsapp3.jpg" alt="Pills app running on iPhone 16 Pro" style="width: 260px; border-radius: 28px; display: block;" />
            </div>
            <p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 16px;">The finished app running on iPhone 16 Pro &mdash; built entirely through conversation</p>
        </div>

        <p class="intro">
            This tutorial documents how the <strong>Pills</strong> app was built entirely through conversation with Claude Code &mdash; from the initial idea through to a polished, tested app running on a real iPhone. It covers the initial prompt, design decisions made through interactive Q&amp;A, iterative UI refinements, programmatic icon generation, local notification scheduling with a smart cancellation architecture, unit testing, and debugging a memory issue caused by an inefficient timer. Use it as a template for building your own apps with AI assistance.
        </p>

        <div class="toc">
            <h3>Contents</h3>
            <ol>
                <li><a href="#step1">Describe Your App Idea</a></li>
                <li><a href="#step2">Answer Design Questions</a></li>
                <li><a href="#step3">Review the Generated Project</a></li>
                <li><a href="#step4">Iterate on the UI</a></li>
                <li><a href="#step5">Add Animations</a></li>
                <li><a href="#step6">Visual Polish - Dimmed Past State</a></li>
                <li><a href="#step7">Generate an App Icon</a></li>
                <li><a href="#step8">Create Documentation</a></li>
                <li><a href="#step9">Lock History to Prevent Accidental Edits</a></li>
                <li><a href="#step10">Add Unit Tests</a></li>
                <li><a href="#step11">Add Notification Reminders</a></li>
                <li><a href="#lessons">Lessons Learned</a></li>
            </ol>
        </div>

        <!-- ─── STEP 1 ─── -->
        <hr>
        <h2 id="step1"><span class="step-num">1</span> Describe Your App Idea</h2>
        <p class="step-subtitle">Be specific about what you want, but leave room for AI suggestions</p>

        <div class="prompt">
            <p>I would like to build an iOS app for iPhone called Pills that helps me keep track of the medication I need to take each day. I would like the app to present a month calendar view for the current month, and on each day show me whether I have yet to take or have already taken my morning and evening pills.</p>
            <p>I'm thinking of cyan and orange horizontal bars overlaid on each day in the calendar, that I can tap on to turn grey, meaning I have taken this days. On previous and future days, the bars can still show, but dimmed if I didn't take / haven't taken that day, or grey if I did.</p>
            <p>We will need to persist the state of each day (today and the past). I can only tap on today or previous days - I can't tap on future days.</p>
            <p>Please create all the files an xcode project will need, set up for my iPhone 16 Pro (currently connected) or prompt me if I need to do any of this. How does this sound? Please ask me questions on anything that is unclear, and please suggest any great ideas you have to enhance this app. Thank you.</p>
        </div>

        <div class="insight">
            <p><strong>What makes this prompt effective:</strong></p>
            <ul>
                <li><strong>Clear purpose</strong> - "track medication I need to take each day"</li>
                <li><strong>Visual specificity</strong> - exact colours (cyan, orange, grey) and interaction model (tap to toggle)</li>
                <li><strong>State rules</strong> - clear logic for past/present/future days</li>
                <li><strong>Technical context</strong> - mentions Xcode, iPhone 16 Pro, persistence needs</li>
                <li><strong>Invites collaboration</strong> - "ask me questions" and "suggest any great ideas"</li>
            </ul>
        </div>

        <div class="response">
            <p>Claude suggested several enhancements before writing any code:</p>
            <ul>
                <li><strong>Haptic feedback</strong> - satisfying tap feel when marking pills</li>
                <li><strong>Month navigation</strong> - swipe or arrows to view previous months</li>
                <li><strong>Streak counter</strong> - consecutive days with all pills taken</li>
                <li><strong>Undo support</strong> - tap a taken bar again to un-mark it</li>
                <li><strong>Today highlight</strong> - visually distinct current day</li>
                <li><strong>Notification reminders</strong> - push notifications for morning/evening</li>
                <li><strong>Home Screen widget</strong> - at-a-glance today status</li>
            </ul>
            <p>It then asked four clarifying questions via an interactive picker.</p>
        </div>

        <!-- ─── STEP 2 ─── -->
        <hr>
        <h2 id="step2"><span class="step-num">2</span> Answer Design Questions</h2>
        <p class="step-subtitle">Claude asks targeted questions to avoid assumptions</p>

        <p>Before writing a single line of code, Claude presented four multiple-choice questions:</p>

        <div class="response">
            <p><strong>Q1: Minimum iOS version?</strong></p>
            <ul>
                <li><strong>iOS 17+ (Recommended)</strong> - chosen. Gives access to SwiftData for persistence.</li>
                <li>iOS 18+ - latest only</li>
                <li>iOS 16+ - broader compatibility</li>
            </ul>
            <p><strong>Q2: Should tapping a taken bar toggle it back?</strong></p>
            <ul>
                <li><strong>Yes, toggle back</strong> - chosen. Allows fixing accidental taps.</li>
                <li>No, one-way only</li>
            </ul>
            <p><strong>Q3: Navigate to previous months?</strong></p>
            <ul>
                <li><strong>Yes (Recommended)</strong> - chosen. Swipe left/right for history.</li>
                <li>No, current month only</li>
            </ul>
            <p><strong>Q4: Which enhancements to include?</strong> (multi-select)</p>
            <ul>
                <li><strong>Haptic feedback</strong> - chosen</li>
                <li><strong>Streak counter</strong> - chosen</li>
                <li><strong>Today highlight</strong> - chosen</li>
                <li>Keep it simple</li>
            </ul>
        </div>

        <div class="tip">
            <p>Claude's interactive questions prevented it from guessing at requirements. Each answer directly shaped the code it wrote. The "Recommended" labels helped guide decisions without being prescriptive.</p>
        </div>

        <!-- ─── STEP 3 ─── -->
        <hr>
        <h2 id="step3"><span class="step-num">3</span> Review the Generated Project</h2>
        <p class="step-subtitle">A complete, buildable Xcode project in one pass</p>

        <div class="response">
            <p>Claude created the full Xcode project structure in a single pass:</p>
        </div>

        <div class="files-created">
            <div class="file-item">Pills.xcodeproj/project.pbxproj</div>
            <div class="file-item">Pills/PillsApp.swift</div>
            <div class="file-item">Pills/ContentView.swift</div>
            <div class="file-item">Pills/Models/PillRecord.swift</div>
            <div class="file-item">Pills/Views/CalendarView.swift</div>
            <div class="file-item">Pills/Views/DayCellView.swift</div>
            <div class="file-item">Pills/Views/StreakView.swift</div>
            <div class="file-item">Assets.xcassets (3 JSON files)</div>
        </div>

        <p>It then verified the build from the command line:</p>
        <pre>xcodebuild -project Pills.xcodeproj -scheme Pills \
  -destination 'generic/platform=iOS' \
  build CODE_SIGNING_ALLOWED=NO

** BUILD SUCCEEDED **</pre>

        <p>The tech stack chosen:
            <span class="badge badge-cyan">Swift 5</span>
            <span class="badge badge-orange">SwiftUI</span>
            <span class="badge badge-blue">SwiftData</span>
        </p>

        <div class="insight">
            <p><strong>Key architecture decisions Claude made:</strong></p>
            <ul>
                <li><strong>SwiftData</strong> over UserDefaults or Core Data - modern, minimal boilerplate, integrates natively with SwiftUI</li>
                <li><strong>Single @Query</strong> for all records, filtered in code - records are bounded (~365/year), avoiding dynamic predicate complexity</li>
                <li><strong>Callback pattern</strong> for toggle actions - DayCellView &rarr; CalendarView &rarr; ContentView, keeping the model context in one place</li>
                <li><strong>Lazy record creation</strong> - no record exists for a day until the user first interacts with it</li>
            </ul>
        </div>

        <div class="response">
            <p>Claude noted one manual step required:</p>
            <ol>
                <li>Open <code>Pills.xcodeproj</code> in Xcode</li>
                <li>Set your <strong>Development Team</strong> in Signing &amp; Capabilities</li>
                <li>Select your iPhone 16 Pro and press Cmd+R</li>
            </ol>
        </div>

        <!-- ─── STEP 4 ─── -->
        <hr>
        <h2 id="step4"><span class="step-num">4</span> Iterate on the UI</h2>
        <p class="step-subtitle">Refine the design through quick, focused feedback</p>

        <p>After running the app, three rounds of visual tweaks were requested. Each was a short, natural-language prompt:</p>

        <h3>Round 1: Fill the screen</h3>
        <div class="prompt">
            <p>Please can you make the month view fill most of the screen, with room to show current streak length etc. Also add forward/back swiping to move between months.</p>
        </div>
        <div class="response">
            <p>Claude rewrote <code>CalendarView</code> to use <code>GeometryReader</code>, distributing available height across exactly 6 week rows. Each cell now expands proportionally. Swipe gestures via <code>DragGesture</code> were added for month navigation.</p>
        </div>

        <h3>Round 2: Adjust bar spacing</h3>
        <div class="prompt">
            <p>I would like a bit more spacing between the pill bars, so less height for each and more of the screen taken up thank you.</p>
        </div>
        <div class="response">
            <p>Claude replaced fixed bar spacing with <code>Spacer()</code> elements between the day number, morning bar, and evening bar. Bars were capped at 10pt max height. VStack spacing was tightened from 12 to 6.</p>
        </div>

        <h3>Round 3: Fine-tune bar thickness</h3>
        <div class="prompt">
            <p>bit too narrow bars, about half way between what we previously had and what we have now thank you.</p>
        </div>
        <div class="response">
            <p>A one-line change: bar max height adjusted from 10pt to 16pt - the midpoint between the two previous values.</p>
        </div>

        <div class="tip">
            <p>Notice how each refinement prompt was short and conversational. You don't need to specify code changes - just describe what you see and what you want different. Claude figures out which files and values to change.</p>
        </div>

        <!-- ─── STEP 5 ─── -->
        <hr>
        <h2 id="step5"><span class="step-num">5</span> Add Animations</h2>
        <p class="step-subtitle">A single sentence request adds polished month transitions</p>

        <div class="prompt">
            <p>Please can we have an animation between months when swiping?</p>
        </div>

        <div class="response">
            <p>Claude added a directional slide animation with three changes to <code>ContentView.swift</code>:</p>
            <ol>
                <li>Added <code>@State private var slideDirection: Edge</code> to track navigation direction</li>
                <li>Applied <code>.id(displayedMonth)</code> on CalendarView so SwiftUI treats each month as a distinct view</li>
                <li>Used <code>.transition(.asymmetric(insertion: .move(...), removal: .move(...)))</code> for the slide effect</li>
            </ol>
            <p>The animation is a 0.3s ease-in-out. When navigating back, the new month slides in from the left; when navigating forward, from the right.</p>
        </div>

        <div class="insight">
            <p><strong>The <code>.id()</code> + <code>.transition()</code> pattern</strong> is a powerful SwiftUI technique. By changing the view's identity (via <code>.id(displayedMonth)</code>), SwiftUI removes the old view and inserts a new one, triggering the specified transition animation. No manual animation state management needed.</p>
        </div>

        <!-- ─── STEP 6 ─── -->
        <hr>
        <h2 id="step6"><span class="step-num">6</span> Visual Polish - Dimmed Past State</h2>
        <p class="step-subtitle">A subtle change that makes today feel immediate</p>

        <div class="prompt">
            <p>Let's dim the 'taken' grey on previous days</p>
        </div>

        <div class="response">
            <p>Claude updated the colour logic in <code>DayCellView.barColor()</code> to distinguish today's taken state from past taken state:</p>
            <pre>if taken && isToday {
    return Color.gray            // solid grey
} else if taken {
    return Color.gray.opacity(0.4)  // dimmed grey
} else if isToday {
    return baseColor             // vivid cyan/orange
} else {
    return baseColor.opacity(0.3)   // dimmed colour
}</pre>
        </div>

        <p>Here's the complete visual state reference after this change:</p>
        <div class="state-ref">
            <div class="state-ref-card">
                <h4>Today - Not Taken</h4>
                <div class="bar cyan"></div>
                <div class="bar orange"></div>
                <div class="note">Full colour, tappable</div>
            </div>
            <div class="state-ref-card">
                <h4>Today - Taken</h4>
                <div class="bar grey"></div>
                <div class="bar grey"></div>
                <div class="note">Solid grey, tappable</div>
            </div>
            <div class="state-ref-card">
                <h4>Past - Missed</h4>
                <div class="bar cyan-dim"></div>
                <div class="bar orange-dim"></div>
                <div class="note">Dimmed colour, tappable</div>
            </div>
            <div class="state-ref-card">
                <h4>Past - Taken</h4>
                <div class="bar grey-dim"></div>
                <div class="bar grey-dim"></div>
                <div class="note">Dimmed grey, tappable</div>
            </div>
            <div class="state-ref-card">
                <h4>Future</h4>
                <div class="bar cyan-dim"></div>
                <div class="bar orange-dim"></div>
                <div class="note">Dimmed, not tappable</div>
            </div>
        </div>

        <div class="tip">
            <p>This small change creates a clear visual hierarchy: today's bars demand attention (vivid or solid grey), while past days recede into the background. The calendar at a glance tells you what needs your action <em>now</em>.</p>
        </div>

        <!-- ─── STEP 7 ─── -->
        <hr>
        <h2 id="step7"><span class="step-num">7</span> Generate an App Icon</h2>
        <p class="step-subtitle">Programmatic icon generation using CoreGraphics</p>

        <div class="prompt">
            <p>I think we need an app icon - I'm thinking something that looks like today with no pills taken yet.</p>
        </div>

        <div class="response">
            <p>Claude wrote a Swift script using <code>AppKit</code> and <code>CoreGraphics</code> to render a 1024x1024 icon that mirrors the app's day cell design: day number "14", a cyan bar, an orange bar, and a subtle blue today-highlight border. Initially rendered on a light background.</p>
        </div>

        <div class="prompt">
            <p>I would prefer it to show as a dark mode icon on my dark mode phone</p>
        </div>

        <div class="response">
            <p>Claude rewrote the generator with a dark colour scheme. It also fixed a Retina scaling issue (the initial version produced a 2048x2048 image due to macOS Retina) by switching from <code>NSImage.lockFocus()</code> to explicit <code>NSBitmapImageRep</code> at 1x pixel scale.</p>
        </div>

        <div class="icon-preview">
            <img src="Pills/Assets.xcassets/AppIcon.appiconset/AppIcon.png" width="180" alt="Pills app icon" />
            <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 12px;">The final dark-mode app icon</p>
        </div>

        <div class="tip">
            <p>Generating icons programmatically with a script means you can tweak colours, sizes, or content and regenerate instantly - no design tool needed. The script was compiled and run in under a second.</p>
        </div>

        <!-- ─── STEP 8 ─── -->
        <hr>
        <h2 id="step8"><span class="step-num">8</span> Create Documentation</h2>
        <p class="step-subtitle">Architecture docs, README, and this tutorial - all generated from code context</p>

        <div class="prompt">
            <p>Please create a claude.md, README.md and architecture.html (the html is design documentation - you can use Mermaid.js for diagrams).</p>
        </div>

        <div class="response">
            <p>Claude read all source files to ensure accuracy, then created:</p>
            <ul>
                <li><strong>CLAUDE.md</strong> - Project context for future Claude Code sessions: tech stack, structure, build commands, architecture decisions, visual state table</li>
                <li><strong>README.md</strong> - User-facing docs with features, setup, and usage instructions</li>
                <li><strong>architecture.html</strong> - Rich design documentation with five Mermaid.js diagrams: view hierarchy, data model (ER), data flow (sequence), calendar layout, and streak algorithm (flowchart)</li>
            </ul>
        </div>

        <div class="insight">
            <p><strong>CLAUDE.md</strong> is special - it serves as persistent context for Claude Code. When you return to this project later and start a new conversation, Claude reads CLAUDE.md first, immediately understanding the project structure, conventions, and decisions without re-exploring the codebase.</p>
        </div>

        <!-- ─── STEP 9 ─── -->
        <hr>
        <h2 id="step9"><span class="step-num">9</span> Lock History to Prevent Accidental Edits</h2>
        <p class="step-subtitle">Protecting past data with a timed unlock mechanism</p>

        <div class="prompt">
            <p>I want to prevent accidental edits to past days. History should be locked by default. When locked, tapping a past day shows an unlock prompt. Unlocking lasts 10 minutes then auto-relocks. A lock icon in the header provides visual state and manual toggle.</p>
        </div>

        <div class="response">
            <p>Claude entered plan mode and asked four clarifying questions about the lock UX:</p>
            <ul>
                <li><strong>Where to show the lock icon?</strong> &mdash; Header bar (chosen), legend area, or floating button</li>
                <li><strong>Unlock indicator style?</strong> &mdash; Subtle icon only (chosen), countdown badge, or pulsing glow</li>
                <li><strong>Relock behaviour?</strong> &mdash; Lock immediately at 10 minutes (chosen), or show a warning first</li>
                <li><strong>Default state?</strong> &mdash; Locked (chosen) or unlocked</li>
            </ul>
            <p>After user answers, Claude produced a detailed implementation plan and requested approval before writing code. All changes were confined to a single file: <code>ContentView.swift</code>.</p>
        </div>

        <div class="response">
            <p>The implementation added these components to <code>ContentView</code>:</p>
            <ul>
                <li><strong>@AppStorage persistence</strong> &mdash; <code>historyLocked</code> (Bool) and <code>unlockTimestamp</code> (TimeInterval) stored in UserDefaults, not SwiftData &mdash; it's a UI preference, not pill data</li>
                <li><strong>Lock icon button</strong> &mdash; <code>lock.fill</code> (locked) / <code>lock.open.fill</code> (unlocked) in the header HStack, with secondary/accent colouring</li>
                <li><strong>Auto-relock timer</strong> &mdash; a single one-shot <code>DispatchWorkItem</code> scheduled for 600 seconds after unlock; on app resume, remaining time is recalculated from the stored timestamp</li>
                <li><strong>Guard in toggle functions</strong> &mdash; <code>toggleMorning</code>/<code>toggleEvening</code> check if the date is past AND locked, storing a pending action and showing an alert</li>
                <li><strong>Unlock alert</strong> &mdash; "History is Locked" with Unlock/Cancel; on Unlock, executes the pending toggle immediately</li>
            </ul>
            <p>Today's bars remain always tappable &mdash; the lock only applies to past days. No changes were needed to <code>DayCellView</code> or <code>CalendarView</code>.</p>
        </div>

        <div class="insight">
            <p><strong>Why @AppStorage over SwiftData?</strong> The lock is a UI preference, not medication data. Using <code>@AppStorage</code> avoids SwiftData model migration, keeps the data model clean, and survives app restarts via UserDefaults automatically. The 10-minute relock uses a single one-shot <code>DispatchWorkItem</code> &mdash; zero CPU while locked. On app resume, the remaining time is recalculated from the stored timestamp, so it works correctly even if the app is killed and restarted within the window.</p>
        </div>

        <div class="tip">
            <p>Claude's plan mode approach &mdash; asking clarifying questions, producing a written plan, and requesting approval before coding &mdash; is especially valuable for features that touch user interaction patterns. The plan confirmed that all changes fit in a single file, keeping the blast radius small.</p>
        </div>

        <!-- ─── STEP 10 ─── -->
        <hr>
        <h2 id="step10"><span class="step-num">10</span> Add Unit Tests</h2>
        <p class="step-subtitle">Testing data mutations with an in-memory SwiftData container</p>

        <div class="prompt">
            <p>I think it's time we added some tests for this project. Please add some in the standard format for an xcode SwiftUI project, that test the data updates that can be triggered by a user. Ask me if you think there are other tests we should cover.</p>
        </div>

        <div class="response">
            <p>Claude read all source files, then created a complete test target:</p>
            <ul>
                <li>Created <code>PillsTests/PillsTests.swift</code> with 19 initial tests</li>
                <li>Extracted the streak calculation from a private computed property to <code>StreakView.calculateStreak(from:)</code> &mdash; a minimal refactor to enable testability</li>
                <li>Hand-edited <code>project.pbxproj</code> to wire up the <code>PillsTests</code> target with correct build configurations, dependency on the app target, and <code>TEST_HOST</code> / <code>BUNDLE_LOADER</code> settings</li>
            </ul>
            <p>All 19 tests passed on first run. Claude then suggested three additional tests:</p>
            <ul>
                <li><strong>Double-toggle round-trip</strong> &mdash; tapping twice returns to the original state</li>
                <li><strong>SwiftData persistence</strong> &mdash; records survive a context rebuild</li>
                <li><strong>Date matching with time components</strong> &mdash; a tap at 2:30 PM finds a record stored at midnight</li>
            </ul>
        </div>

        <div class="prompt">
            <p>yes add those three as well</p>
        </div>

        <div class="response">
            <p>Claude added four more tests (two for double-toggle covering morning and evening, plus persistence and date matching), bringing the total to 23. All passed. Later, 26 more tests were added covering notification scheduling decisions, cancellation ID generation, and foreground suppression logic &mdash; bringing the final total to 49.</p>
        </div>

        <div class="insight">
            <p><strong>Testing strategy:</strong> The tests replicate the toggle logic from <code>ContentView</code> as helper methods operating against a real <code>ModelContext</code> backed by an in-memory store. This validates the exact same find-or-create-then-toggle pattern the app uses, without needing to drive the UI. The in-memory container ensures tests are fast and isolated.</p>
        </div>

        <div class="tip">
            <p>Claude proactively suggested additional test cases after delivering the initial set. Asking "what else should we test?" is a great pattern &mdash; the AI can often spot edge cases (like date normalisation across time zones, or double-toggle idempotency) that are easy to overlook.</p>
        </div>

        <!-- ─── STEP 11 ─── -->
        <hr>
        <h2 id="step11"><span class="step-num">11</span> Add Notification Reminders</h2>
        <p class="step-subtitle">Morning and evening pill reminders with a settings page</p>

        <div class="prompt">
            <p>I want reminder notifications that fire at user-configured times if pills haven't been taken yet. Tapping the notification should open the app. Add a settings page (accessed via a cog icon in the header) to enable/disable notifications, set times, and toggle the history lock.</p>
        </div>

        <div class="response">
            <p>Claude entered plan mode and designed a <strong>smart cancellation</strong> architecture. Since iOS local notifications can't run custom code at delivery time when the app is backgrounded, the approach is:</p>
            <ol>
                <li>Schedule non-repeating notifications for the next 7 days ahead of time</li>
                <li>Cancel specific notifications immediately when a pill is marked as taken</li>
                <li>Suppress notifications via the <code>willPresent</code> delegate if the app is in the foreground and the pill is already taken</li>
                <li>Reschedule everything whenever the app becomes active</li>
            </ol>
        </div>

        <div class="response">
            <p>Two new files were created:</p>
        </div>

        <div class="files-created">
            <div class="file-item">Pills/Services/NotificationManager.swift</div>
            <div class="file-item">Pills/Views/SettingsView.swift</div>
        </div>

        <div class="response">
            <p><strong>NotificationManager</strong> &mdash; a singleton <code>NSObject</code> conforming to <code>UNUserNotificationCenterDelegate</code>:</p>
            <ul>
                <li><code>configure(with: ModelContainer)</code> &mdash; stores container for SwiftData queries, sets self as delegate</li>
                <li><code>rescheduleAll()</code> &mdash; cancels all pending notifications, then schedules morning/evening notifications for the next 7 days, skipping periods where pills are already taken</li>
                <li><code>cancelTodayMorning()</code> / <code>cancelTodayEvening()</code> &mdash; cancel a specific notification by ID (<code>morning-YYYY-MM-DD</code>)</li>
                <li><code>willPresent</code> delegate &mdash; queries SwiftData and suppresses notification if pill already taken</li>
            </ul>
            <p><strong>SettingsView</strong> &mdash; a modal sheet with a <code>Form</code>:</p>
            <ul>
                <li>Notifications section: enable/disable toggle, morning <code>DatePicker</code> (default 7:00 AM), evening <code>DatePicker</code> (default 9:00 PM)</li>
                <li>History section: "Lock Past Days" toggle sharing <code>@AppStorage</code> with ContentView</li>
                <li>Custom <code>Binding&lt;Date&gt;</code> bridges between hour/minute <code>@AppStorage</code> Ints and <code>DatePicker</code></li>
                <li>Handles notification permission flow: request if not determined, show "Open Settings" if denied</li>
            </ul>
            <p><strong>PillsApp</strong> was updated to create the <code>ModelContainer</code> explicitly in <code>init()</code> so it can be shared with <code>NotificationManager</code>.</p>
            <p><strong>ContentView</strong> gained a gear icon, a settings sheet, <code>scenePhase</code> handling to reschedule on foreground, and notification cancellation calls in the toggle methods.</p>
        </div>

        <div class="insight">
            <p><strong>Smart cancellation vs. dynamic notifications:</strong> The ideal approach would be to check at notification delivery time whether the pill was taken, but iOS doesn't allow local notifications to run arbitrary code at delivery. The smart cancellation pattern &mdash; schedule optimistically, cancel when taken &mdash; achieves the same result by leveraging the fact that marking a pill as taken requires opening the app, which triggers the cancellation.</p>
        </div>

        <div style="text-align: center; margin: 32px 0;">
            <div style="display: inline-block; background: #000; border-radius: 24px; padding: 10px; box-shadow: 0 16px 64px rgba(0,0,0,0.6);">
                <img src="reminder.jpg" alt="Evening pill reminder notification on iPhone" style="width: 300px; border-radius: 16px; display: block;" />
            </div>
            <p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 14px;">A real evening pill reminder notification on the home screen</p>
        </div>

        <div class="tip">
            <p>By using plan mode, Claude laid out the full architecture &mdash; including the constraint that local notifications can't execute code at delivery time &mdash; before writing a single line. This prevented a false start with an approach that wouldn't work on iOS.</p>
        </div>

        <!-- ─── LESSONS ─── -->
        <hr>
        <h2 id="lessons">Lessons Learned</h2>
        <p class="step-subtitle">Patterns for effective AI-assisted app development</p>

        <div class="response">
            <h3>1. Start with a rich initial prompt</h3>
            <p>The first message described the purpose, visual design, interaction model, and constraints. This gave Claude enough context to make smart architecture choices (SwiftUI + SwiftData) and suggest relevant enhancements (streak counter, haptics) before writing code.</p>

            <h3>2. Let the AI ask questions</h3>
            <p>By saying "ask me questions on anything that is unclear", Claude was able to present four targeted questions that directly shaped the implementation. This avoided assumptions and rework.</p>

            <h3>3. Iterate with natural language</h3>
            <p>UI refinements were described conversationally: "bit too narrow bars, about half way between what we previously had and what we have now." Claude translated these subjective descriptions into precise code changes. Multiple rounds of feedback produced a polished result.</p>

            <h3>4. Build incrementally</h3>
            <p>The app was built in stages - core functionality first, then layout improvements, then animations, then visual polish, then icon, then docs. Each stage produced a working app that could be tested on device.</p>

            <h3>5. Verify each change</h3>
            <p>Claude ran <code>xcodebuild</code> after every change to catch errors immediately. The Retina icon scaling bug was caught and fixed in the same turn it was introduced.</p>

            <h3>6. Use AI for code review and debugging</h3>
            <p>After the notification feature was built and working, the app was killed by iOS for excessive memory usage. Asking Claude to investigate revealed the cause: a <code>Timer.publish(every: 1)</code> polling timer that fired every second for the entire app lifetime, even when the history lock was engaged. Claude replaced it with a single one-shot <code>DispatchWorkItem</code> scheduled only on unlock &mdash; zero CPU while locked. This kind of iterative diagnosis and fix is where AI assistance shines: Claude can reason about runtime behaviour, identify inefficient patterns, and refactor with confidence because the test suite catches regressions.</p>

            <h3>7. Use CLAUDE.md for project memory</h3>
            <p>Creating a CLAUDE.md file means future sessions with Claude Code will start with full project context, enabling seamless continuation of development.</p>
        </div>

        <hr>

        <h2>Final Project Stats</h2>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin: 24px 0;">
            <div style="background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 20px; text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; color: var(--accent-cyan);">9</div>
                <div style="color: var(--text-muted); font-size: 0.85rem;">Swift files</div>
            </div>
            <div style="background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 20px; text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; color: var(--accent-orange);">~700</div>
                <div style="color: var(--text-muted); font-size: 0.85rem;">Lines of Swift code</div>
            </div>
            <div style="background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 20px; text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; color: var(--accent-blue);">49</div>
                <div style="color: var(--text-muted); font-size: 0.85rem;">Unit tests</div>
            </div>
            <div style="background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 20px; text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; color: var(--accent-green);">13</div>
                <div style="color: var(--text-muted); font-size: 0.85rem;">Prompts to build</div>
            </div>
            <div style="background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 20px; text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; color: var(--accent-purple);">0</div>
                <div style="color: var(--text-muted); font-size: 0.85rem;">External dependencies</div>
            </div>
            <div style="background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 20px; text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; color: var(--accent-cyan);">2</div>
                <div style="color: var(--text-muted); font-size: 0.85rem;">Conversations</div>
            </div>
        </div>

        <p style="text-align: center; color: var(--text-muted); margin-top: 48px; font-size: 0.9rem;">
            <a href="https://github.com/pcwilliams/pills" style="color: var(--accent-orange); text-decoration: none;">Source on GitHub</a> &mdash; Built with <a href="https://claude.ai/claude-code" style="color: var(--accent-cyan); text-decoration: none;">Claude Code</a> &mdash; February 2026
        </p>

    </div>
</body>
</html>
